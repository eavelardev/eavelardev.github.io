<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
<title>Time series forecasting — Eduardo Avelar</title>
<!-- Loaded before other Sphinx assets -->
<link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
<link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
<link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
<link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" rel="stylesheet" type="text/css"/>
<link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/mystyle.css" rel="stylesheet" type="text/css"/>
<link href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" rel="stylesheet" type="text/css"/>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
<script src="../../_static/jquery.js"></script>
<script src="../../_static/underscore.js"></script>
<script src="../../_static/doctools.js"></script>
<script src="../../_static/clipboard.min.js"></script>
<script src="../../_static/copybutton.js"></script>
<script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="../../_static/togglebutton.js"></script>
<script src="../../_static/myscript.js"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
<script src="../../_static/design-tabs.js"></script>
<link href="../../_static/logo.png" rel="shortcut icon"/>
<link href="../../genindex.html" rel="index" title="Index"/>
<link href="../../search.html" rel="search" title="Search"/>
<link href="../distribute/index.html" rel="next" title="Distributed training"/>
<link href="index.html" rel="prev" title="Structured Data"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="None" name="docsearch:language"/>
<!-- Google Analytics -->
</head>
<body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
<!-- Checkboxes to toggle the left sidebar -->
<input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
<label class="overlay overlay-navbar" for="__navigation">
<div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
<label class="overlay overlay-pagetoc" for="__page-toc">
<div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>
<div class="container-fluid" id="banner"></div>
<div class="container-xl">
<div class="row">
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
<div class="bd-sidebar__content">
<div class="bd-sidebar__top"><div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
<!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
<img alt="logo" class="logo" src="../../_static/logo.png"/>
<h1 class="site-logo" id="site-title">Eduardo Avelar</h1>
</a>
</div><form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
<i class="icon fas fa-search"></i>
<input aria-label="" autocomplete="off" class="form-control" id="search-input" name="q" placeholder="" type="search"/>
</form><nav aria-label="Main" class="bd-links" id="bd-docs-nav">
<div class="bd-toc-item active">
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../elearning_ml_data/index.html">
   E-learning ML/Data resources
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
<label for="toctree-checkbox-1">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/books.html">
     ML/Data/Dev Books
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/coursera.html">
     Coursera courses
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/gcp_data_analysis.html">
     GCP Courses/Videos Analysis
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/gcp_skills_boost_updates.html">
     GCP Skills Boost Updates
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/google_cloud_labs.html">
     GCP ML/Data labs
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/ml_pages_posts.html">
     Pages/Posts/Lectures
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/ml_platforms.html">
     Platforms/Tools
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../elearning_ml_data/ml_training.html">
     Courses/Videos
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../mldev_tools/index.html">
   Dev-ML Tools
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
<label for="toctree-checkbox-2">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../mldev_tools/check_duplicated_questions.html">
     Check for duplicated questions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../mldev_tools/create_questions_html.html">
     Create html page with ML questions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../mldev_tools/paste_online_ext.html">
     VS Code ext to paste one line
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../mldev_tools/qwiklabs_quiz_to_json.html">
     Qwiklabs Quizzes to JSON
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../mldev_tools/site_builder.html">
     GCP Courses Builder
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../mldev_tools/videoslides_to_images.html">
     GCP Videos to Images
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../dev_notes/index.html">
   My Dev notes
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
<label for="toctree-checkbox-3">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../dev_notes/dev-essentials.html">
     apt install dev-essentials
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../dev_notes/dev_commands.html">
     Dev commands
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../dev_notes/dev_troubleshoot.html">
     Dev Troubleshooting Notes
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../dev_notes/install_kubeflow.html">
     Install Kubeflow Pipelines for Local Deployment
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../dev_notes/kfp_v1.html">
     Kubeflow Pipelines v1 sdk v2 examples
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../dev_notes/my_vscode_theme.html">
     My VS Code theme
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../ml_notes/index.html">
   ML Notes
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
<label for="toctree-checkbox-4">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../ml_notes/good_practice.html">
     ML Good practice
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../ml_notes/nvidia_tools.html">
     Nvidia ML
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../gcp_courses/index.html">
   Google Cloud Skills Boost Courses
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
<label for="toctree-checkbox-5">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_courses/gcp_big_data_and_ml_fundamentals/index.html">
     Google Cloud Big Data and Machine Learning Fundamentals
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_courses/how_google_does_ml/index.html">
     How Google Does Machine Learning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_courses/launching_into_ml/index.html">
     Launching into Machine Learning
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_courses/tf_on_gcp/index.html">
     TensorFlow on Google Cloud
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_courses/feature_engineering/index.html">
     Feature Engineering
    </a>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/index.html">
     Machine Learning in the Enterprise
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
<label for="toctree-checkbox-6">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_vizier_hyperparameter/index.html">
       Vertex Vizier Hyperparameter Tuning
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
<label for="toctree-checkbox-7">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_vizier_hyperparameter/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_vizier_hyperparameter/vertex_ai_vizier_hyperparameter_tuning.html">
         Vertex AI Vizier hyperparameter tuning
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_vizier_hyperparameter/lab_intro_vertex_vizier_hyperparameter_tuning.html">
         Lab intro: Vertex Vizier Hyperparameter Tuning
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/prediction_and_model_monitor/index.html">
       Prediction and Model Monitoring using Vertex AI
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
<label for="toctree-checkbox-8">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/prediction_and_model_monitor/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/prediction_and_model_monitor/predictions_using_vertex_ai.html">
         Predictions using Vertex AI
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/prediction_and_model_monitor/model_management_using_vertex_ai.html">
         Model management using Vertex AI
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/prediction_and_model_monitor/lab_intro_vertex_ai_model_monitoring.html">
         Lab intro: Vertex AI Model Monitoring
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_ai_pipelines/index.html">
       Vertex AI Pipelines
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
<label for="toctree-checkbox-9">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_ai_pipelines/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_ai_pipelines/prediction_using_vertex_ai_pipelines.html">
         Prediction using Vertex AI pipelines
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/vertex_ai_pipelines/lab_intro_vertex_ai_pipelines.html">
         Lab intro: Vertex AI Pipelines
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/best_practices_for_ml_develo/index.html">
       Best Practices for Machine Learning Development
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
<label for="toctree-checkbox-10">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/best_practices_for_ml_develo/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/best_practices_for_ml_develo/best_practices_for_model_deployment_and_serving.html">
         Best practices for model deployment and serving
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/best_practices_for_ml_develo/best_practices_for_model_monitoring.html">
         Best practices for model monitoring
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/best_practices_for_ml_develo/vertex_ai_pipeline_best_practices.html">
         Vertex AI pipeline best practices
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/best_practices_for_ml_develo/best_practices_for_artifact_organization.html">
         Best practices for artifact organization
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/series_summary/index.html">
       Series Summary
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
<label for="toctree-checkbox-11">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/series_summary/series_summary.html">
         Series summary
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/working_dir/index.html">
       Working dir
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
<label for="toctree-checkbox-12">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_in_the_enterprise/working_dir/my_intro_to_vertex_pipelines.html">
         intro_to_vertex_pipelines.ipynb
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/index.html">
     Production Machine Learning Systems
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
<label for="toctree-checkbox-13">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/intro_to_advanced_ml_on_gcp/index.html">
       Introduction to Advanced Machine Learning on Google Cloud
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
<label for="toctree-checkbox-14">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/intro_to_advanced_ml_on_gcp/advanced_ml_on_gcp.html">
         Advanced Machine Learning on Google Cloud
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/intro_to_advanced_ml_on_gcp/welcome.html">
         Welcome
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/index.html">
       Architecting Production ML Systems
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
<label for="toctree-checkbox-15">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/architecting_ml_systems.html">
         Architecting ML systems
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/data_extraction_analysis_and_preparation.html">
         Data extraction, analysis, and preparation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/model_training_evaluation_and_validation.html">
         Model training, evaluation, and validation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/trained_model_prediction_service_and_performance_mo.html">
         Trained model, prediction service, and performance monitoring
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/training_design_decisions.html">
         Training design decisions
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/serving_design_decisions.html">
         Serving design decisions
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/using_vertex_ai.html">
         Using Vertex AI
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/architecting_production_ml_s/lab_intro_structured_data_prediction.html">
         Lab introduction: Structured data prediction
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/index.html">
       Designing Adaptable ML Systems
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
<label for="toctree-checkbox-16">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/adapting_to_data.html">
         Adapting to data
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/changing_distributions.html">
         Changing distributions
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/lab_adapting_to_data.html">
         Lab: Adapting to data
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/right_and_wrong_decisions.html">
         Right and wrong decisions
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/system_failure.html">
         System failure
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/concept_drift.html">
         Concept drift
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/actions_to_mitigate_concept_drift.html">
         Actions to mitigate concept drift
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/tf_data_validation.html">
         TensorFlow data validation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/components_of_tf_data_validation.html">
         Components of TensorFlow data validation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/lab_intro_intro_to_tf_data_validation.html">
         Lab Introduction: Introduction to TensorFlow Data Validation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/lab_intro_advanced_visualizations_with_tf_data_vali.html">
         Lab Introduction: Advanced Visualizations with TensorFlow Data Validation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/mitigating_training_serving_skew_through_design.html">
         Mitigating training-serving skew through design
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/lab_intro_serving_ml_predictions_in_batch_and_real.html">
         Lab Introduction: Serving ML Predictions in Batch and Real Time
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_adaptable_ml_syste/diagnosing_a_production_model.html">
         Diagnosing a production model
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/index.html">
       Designing High-performance ML Systems
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
<label for="toctree-checkbox-17">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/training.html">
         Training
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/why_distributed_training_is_needed.html">
         Why distributed training is needed
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/distributed_training_architectures.html">
         Distributed training architectures
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/tf_distributed_training_strategies.html">
         TensorFlow distributed training strategies
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/mirrored_strategy.html">
         Mirrored strategy
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/multi_worker_mirrored_strategy.html">
         Multi-worker mirrored strategy
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/tpu_strategy.html">
         TPU strategy
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/parameter_server_strategy.html">
         Parameter server strategy
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/lab_intro_distributed_training_with_keras.html">
         Lab Introduction: Distributed Training with Keras
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/lab_intro_distributed_training_using_gpus_on_cloud.html">
         Lab Introduction: Distributed Training using GPUs on Cloud AI Platform
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/training_on_large_datasets_with_tf_data_api.html">
         Training on large datasets with tf.data API
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/designing_high_performance_m/lab_intro_tpu_speed_data_pipelines.html">
         Lab Introduction: TPU-speed Data Pipelines
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/building_hybrid_ml_systems/index.html">
       Building Hybrid ML Systems
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
<label for="toctree-checkbox-18">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/building_hybrid_ml_systems/kubeflow.html">
         Kubeflow
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/building_hybrid_ml_systems/optimizing_tf_for_mobile.html">
         Optimizing TensorFlow for mobile
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/summary/index.html">
       Summary
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
<label for="toctree-checkbox-19">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/summary/course_summary.html">
         Course summary
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/working_dir/index.html">
       Working dir
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-20" name="toctree-checkbox-20" type="checkbox"/>
<label for="toctree-checkbox-20">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/working_dir/my_keras.html">
         keras.ipynb
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/working_dir/my_serving_ml_prediction.html">
         serving_ml_prediction.ipynb
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/working_dir/my_tfdv_basic_spending.html">
         tfdv_basic_spending.ipynb
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/production_ml_systems/working_dir/my_train_deploy.html">
         babyweight/train_deploy.ipynb
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/index.html">
     Computer Vision Fundamentals with Google Cloud
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-21" name="toctree-checkbox-21" type="checkbox"/>
<label for="toctree-checkbox-21">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/intro_to_cv_and_pre_built_ml/index.html">
       Introduction to Computer Vision and Pre-built ML Models for Image Classification
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-22" name="toctree-checkbox-22" type="checkbox"/>
<label for="toctree-checkbox-22">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/intro_to_cv_and_pre_built_ml/what_is_cv.html">
         What Is Computer Vision
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/intro_to_cv_and_pre_built_ml/different_type_of_cv_problems.html">
         Different Type of Computer Vision Problems
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/intro_to_cv_and_pre_built_ml/cv_use_cases.html">
         Computer Vision Use Cases
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/intro_to_cv_and_pre_built_ml/vision_api_pre_built_ml_models.html">
         Vision API - Pre-built ML Models
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/index.html">
       Vertex AI and AutoML Vision on Vertex AI
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-23" name="toctree-checkbox-23" type="checkbox"/>
<label for="toctree-checkbox-23">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/what_is_vertex_ai_and_why_does_a_unified_platform_m.html">
         What is Vertex AI and why does a unified platform matter?
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/intro_to_automl_vision_on_vertex_ai.html">
         Introduction to AutoML Vision on Vertex AI
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/how_does_vertex_ai_help_with_the_ml_workflow_part_1.html">
         How does Vertex AI help with the ML workflow, part 1 ?
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/how_does_vertex_ai_help_with_the_ml_workflow_part_2.html">
         How does Vertex AI help with the ML workflow, part 2 ?
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/which_vision_product_is_right_for_you.html">
         Which vision product is right for you?
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/vertex_ai_and_automl_vision/lab_intro_identifying_damaged_car_parts_with_vertex.html">
         Lab Introduction - Identifying Damaged Car Parts with Vertex AI for AutoML Vision users
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/index.html">
       Custom Training with Linear, Neural Network and Deep Neural Network models
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-24" name="toctree-checkbox-24" type="checkbox"/>
<label for="toctree-checkbox-24">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/intro_to_linear_models.html">
         Introduction to Linear Models
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/reading_the_data.html">
         Reading the Data
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/implementing_linear_models_for_image_classification.html">
         Implementing Linear Models for Image Classification
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/nns_and_dnns_for_image_classification.html">
         Neural Networks and Deep Neural Networks for Image Classification
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/custom_training_with_linear/dnns_with_dropout_and_batch_normalization.html">
         Deep Neural Networks with Dropout and Batch Normalization
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/index.html">
       Convolutional Neural Networks
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-25" name="toctree-checkbox-25" type="checkbox"/>
<label for="toctree-checkbox-25">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/cnns.html">
         Convolutional Neural Networks
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/understanding_convolutions.html">
         Understanding Convolutions
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/cnn_model_parameters.html">
         CNN Model Parameters
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/working_with_pooling_layers.html">
         Working with Pooling Layers
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/cnns/implementing_cnns_on_vertex_ai_with_pre_built_tf_co.html">
         Implementing CNNs on Vertex AI with pre-built TF container using Vertex Workbench
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/dealing_with_image_data/index.html">
       Dealing with Image Data
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-26" name="toctree-checkbox-26" type="checkbox"/>
<label for="toctree-checkbox-26">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/dealing_with_image_data/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/dealing_with_image_data/preprocessing_the_image_data.html">
         Preprocessing the Image Data
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/dealing_with_image_data/model_parameters_and_the_data_scarcity_problem.html">
         Model Parameters and the Data Scarcity Problem
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/dealing_with_image_data/data_augmentation.html">
         Data Augmentation
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/dealing_with_image_data/transfer_learning.html">
         Transfer Learning
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/summary/index.html">
       Summary
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-27" name="toctree-checkbox-27" type="checkbox"/>
<label for="toctree-checkbox-27">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/cv_fundamentals_with_gcp/summary/summary.html">
         Summary
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/index.html">
     Natural Language Processing on Google Cloud
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-28" name="toctree-checkbox-28" type="checkbox"/>
<label for="toctree-checkbox-28">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/course_intro/index.html">
       Course introduction
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-29" name="toctree-checkbox-29" type="checkbox"/>
<label for="toctree-checkbox-29">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/course_intro/course_intro.html">
         Course Introduction
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/index.html">
       NLP on Google Cloud
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-30" name="toctree-checkbox-30" type="checkbox"/>
<label for="toctree-checkbox-30">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/what_is_nlp.html">
         What is NLP?
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/nlp_history.html">
         NLP history
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/nlp_architecture.html">
         NLP architecture
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/nlp_apis.html">
         NLP APIs
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/nlp_solutions.html">
         NLP solutions
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_on_gcp/summary.html">
         Summary
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/index.html">
       NLP with Vertex AI
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-31" name="toctree-checkbox-31" type="checkbox"/>
<label for="toctree-checkbox-31">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/nlp_options.html">
         NLP options
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/vertex_ai.html">
         Vertex AI
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/nlp_with_automl.html">
         NLP with AutoML
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/nlp_with_custom_training.html">
         NLP with custom training
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/nlp_end_to_end_workflow.html">
         NLP end-to-end workflow
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/nlp_with_vertex_ai/summary.html">
         Summary
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/index.html">
       Text representation
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-32" name="toctree-checkbox-32" type="checkbox"/>
<label for="toctree-checkbox-32">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/tokenization.html">
         Tokenization
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/one_hot_encoding_and_bag_of_words.html">
         One-hot encoding and bag-of-words
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/word_embeddings.html">
         Word embeddings
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/word2vec.html">
         Word2vec
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/transfer_learning_and_reusable_embeddings.html">
         Transfer learning and reusable embeddings
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/text_representation/summary.html">
         Summary
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/index.html">
       Advanced NLP models
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-33" name="toctree-checkbox-33" type="checkbox"/>
<label for="toctree-checkbox-33">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/intro.html">
         Introduction
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/encoder_decoder_architecture.html">
         Encoder-decoder architecture
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/attention_mechanism.html">
         Attention mechanism
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/transformer.html">
         Transformer
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/bert.html">
         BERT
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/large_language_models.html">
         Large language models
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/lab_intro_text_translation_using_encoder_decoder_ar.html">
         Lab introduction: Text Translation using Encoder-decoder Architecture
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/nlp_on_gcp/advanced_nlp_models/summary.html">
         Summary
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/index.html">
     Recommendation Systems on Google Cloud
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-34" name="toctree-checkbox-34" type="checkbox"/>
<label for="toctree-checkbox-34">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/recommendation_systems_overv/index.html">
       Recommendation Systems Overview
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-35" name="toctree-checkbox-35" type="checkbox"/>
<label for="toctree-checkbox-35">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/recommendation_systems_overv/types_of_recommendation_systems.html">
         Types of Recommendation Systems
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/recommendation_systems_overv/content_based_or_collaborative.html">
         Content-Based or Collaborative
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/recommendation_systems_overv/recommendation_system_pitfalls.html">
         Recommendation System Pitfalls
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/index.html">
       Content-Based Recommendation Systems
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-36" name="toctree-checkbox-36" type="checkbox"/>
<label for="toctree-checkbox-36">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/content_based_recommendation_systems.html">
         Content-Based Recommendation Systems
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/similarity_measures.html">
         Similarity Measures
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/building_a_user_vector.html">
         Building a User Vector
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/making_recommendations_using_a_user_vector.html">
         Making Recommendations Using a User Vector
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/making_recommendations_for_many_users.html">
         Making Recommendations for Many Users
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/recommendation_systems_on_gcp/content_based_recommendation/using_nns_for_content_based_recommendation_systems.html">
         Using Neural Networks for Content-Based Recommendation Systems
        </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/index.html">
     Machine Learning Operations (MLOps): Getting Started
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-37" name="toctree-checkbox-37" type="checkbox"/>
<label for="toctree-checkbox-37">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/employing_ml_operations/index.html">
       Employing Machine Learning Operations
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-38" name="toctree-checkbox-38" type="checkbox"/>
<label for="toctree-checkbox-38">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/employing_ml_operations/ml_ml_practitioners_pain_points.html">
         Machine learning (ML) practitioners’ pain points
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/employing_ml_operations/the_concept_of_devops_in_ml.html">
         The concept of devOps in ML
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/employing_ml_operations/ml_lifecycle.html">
         ML lifecycle
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/employing_ml_operations/automating_the_ml_process.html">
         Automating the ML process
        </a>
</li>
</ul>
</li>
<li class="toctree-l3 has-children">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/vertex_ai_and_mlops_on_verte/index.html">
       Vertex AI and MLOps on Vertex AI
      </a>
<input class="toctree-checkbox" id="toctree-checkbox-39" name="toctree-checkbox-39" type="checkbox"/>
<label for="toctree-checkbox-39">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/vertex_ai_and_mlops_on_verte/what_is_vertex_ai_and_why_does_a_unified_platform_m.html">
         What is vertex ai and why does a unified platform matter?
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/vertex_ai_and_mlops_on_verte/intro_to_mlops_on_vertex_ai.html">
         Introduction to mlops on vertex ai
        </a>
</li>
<li class="toctree-l4">
<a class="reference internal" href="../../gcp_courses/ml_operations_mlops_getting_started/vertex_ai_and_mlops_on_verte/how_does_vertex_ai_help_with_the_mlops_workflow_par.html">
         How does vertex ai help with the mlops workflow, part 2?
        </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../gcp_official/index.html">
   Official GCP codes
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-40" name="toctree-checkbox-40" type="checkbox"/>
<label for="toctree-checkbox-40">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_official/Create%20machine%20learning%20models%20in%20BigQuery%20ML.html">
     Create machine learning models in BigQuery ML
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../gcp_resources/index.html">
   GCP notes/resources
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-41" name="toctree-checkbox-41" type="checkbox"/>
<label for="toctree-checkbox-41">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_resources/gcp_setup.html">
     GCP notes
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_resources/ml_cert_exam_guide.html">
     Machine Learning Cert guide
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_resources/notebooks_to_do.html">
     Notebooks To Do
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../gcp_resources/vertex_ai_mlops.html">
     Vertex AI MLOps
    </a>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children">
<a class="reference internal" href="../index.html">
   Official TF codes
  </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-42" name="toctree-checkbox-42" type="checkbox"/>
<label for="toctree-checkbox-42">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l2 current active has-children">
<a class="reference internal" href="index.html">
     Structured Data
    </a>
<input checked="" class="toctree-checkbox" id="toctree-checkbox-43" name="toctree-checkbox-43" type="checkbox"/>
<label for="toctree-checkbox-43">
<i class="fas fa-chevron-down">
</i>
</label>
<ul class="current">
<li class="toctree-l3 current active">
<a class="current reference internal" href="#">
       Time series forecasting
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../distribute/index.html">
     Distributed training
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-44" name="toctree-checkbox-44" type="checkbox"/>
<label for="toctree-checkbox-44">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../distribute/multi_worker_with_keras.html">
       Multi-worker training with Keras
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../tf_resources/index.html">
   Tensorflow Notebooks
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-45" name="toctree-checkbox-45" type="checkbox"/>
<label for="toctree-checkbox-45">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2">
<a class="reference internal" href="../../tf_resources/libs.html">
     TF Libraries &amp; extensions
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../tf_resources/my_tfdv_basic.html">
     tfdv_basic.ipynb
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../tf_resources/preprocessing.html">
     Preprocessing Layers and tools
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../tf_resources/sklearn.html">
     Scikit Learn anf TF
    </a>
</li>
<li class="toctree-l2">
<a class="reference internal" href="../../tf_resources/tf_cert.html">
     TensorFlow Developer Certificate
    </a>
</li>
</ul>
</li>
<li class="toctree-l1">
<a class="reference internal" href="../../feature_eng/index.html">
   Feature Engineering Tools
  </a>
</li>
<li class="toctree-l1 has-children">
<a class="reference internal" href="../../deeplearningai/index.html">
   DeepLearning.AI Courses
  </a>
<input class="toctree-checkbox" id="toctree-checkbox-46" name="toctree-checkbox-46" type="checkbox"/>
<label for="toctree-checkbox-46">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/index.html">
     TensorFlow Dev Cert - original version
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-47" name="toctree-checkbox-47" type="checkbox"/>
<label for="toctree-checkbox-47">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c1w1_housing_prices.html">
       C1W1 Assignment: Housing Prices
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c1w2_%20callbacks_mnist.html">
       C1W2: Implementing Callbacks in TensorFlow using the MNIST Dataset
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c1w3_mnist_convolutions.html">
       C1W3: Improve MNIST with Convolutions
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c1w4_complex_images_happy_sad.html">
       C1W4: Handling Complex Images - Happy or Sad Dataset
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c2w1_cnns_cats_vs_dogs.html">
       C2W1: Using CNN’s with the Cats vs Dogs Dataset
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c2w2_overfitting_data_augmentation.html">
       C2W2: Tackle Overfitting with Data Augmentation
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c2w3_transfer_learning.html">
       C2W3: Transfer Learning
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c2w4_multi_class_classification.html">
       C2W4: Multi-class Classification
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c3w1_bbc_news_archive.html">
       C3W1: Explore the BBC News archive
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c3w2_deep_bbc_news_archive.html">
       C3W2: Diving deeper into the BBC News archive
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c3w3_overfitting_nlp.html">
       C3W3: Exploring Overfitting in NLP
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c3w4_predicting_next_word.html">
       C3W4: Predicting the next word
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c4w1_working_with_time_series.html">
       C4W1: Working with time series
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c4w2_predicting_time_series.html">
       C4W2: Predicting time series
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c4w3_rnns_predict_time_series.html">
       C4W3: Using RNNs to predict time series
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_original/c4w4_using_real_world_data.html">
       C4W4: Using real world data
      </a>
</li>
</ul>
</li>
<li class="toctree-l2 has-children">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/index.html">
     TensorFlow Dev Cert - updated
    </a>
<input class="toctree-checkbox" id="toctree-checkbox-48" name="toctree-checkbox-48" type="checkbox"/>
<label for="toctree-checkbox-48">
<i class="fas fa-chevron-down">
</i>
</label>
<ul>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c1w1_housing_prices.html">
       C1W1 Assignment: Housing Prices
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c1w2_%20callbacks_mnist.html">
       C1W2: Implementing Callbacks in TensorFlow using the MNIST Dataset
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c1w3_mnist_convolutions.html">
       C1W3: Improve MNIST with Convolutions
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c1w4_complex_images_happy_sad.html">
       C1W4: Handling Complex Images - Happy or Sad Dataset
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c2w1_cnns_cats_vs_dogs.html">
       C2W1: Using CNN’s with the Cats vs Dogs Dataset
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c2w2_overfitting_data_augmentation.html">
       C2W2: Tackle Overfitting with Data Augmentation
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c2w3_transfer_learning.html">
       C2W3: Transfer Learning
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c2w4_multi_class_classification.html">
       C2W4: Multi-class Classification
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c3w1_bbc_news_archive.html">
       C3W1: Explore the BBC News archive
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c3w2_deep_bbc_news_archive.html">
       C3W2: Diving deeper into the BBC News archive
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c3w3_overfitting_nlp.html">
       C3W3: Exploring Overfitting in NLP
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c3w4_predicting_next_word.html">
       C3W4: Predicting the next word
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c4w1_working_with_time_series.html">
       C4W1: Working with time series
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c4w2_predicting_time_series.html">
       C4W2: Predicting time series
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c4w3_rnns_predict_time_series.html">
       C4W3: Using RNNs to predict time series
      </a>
</li>
<li class="toctree-l3">
<a class="reference internal" href="../../deeplearningai/tf_dev_course_updated/c4w4_using_real_world_data.html">
       C4W4: Using real world data
      </a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav></div>

</div>
<div id="rtd-footer-container"></div>
</div>
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
<div class="header-article row sticky-top noprint">
<div class="col py-1 d-flex header-article-main">
<div class="header-article__left">
<label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
<span class="headerbtn__icon-container">
<i class="fas fa-bars"></i>
</span>
</label>
</div>
<div class="header-article__right"></div>
</div>
<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
<div class="tocsection onthispage pt-5 pb-3">
<i class="fas fa-list"></i> Contents
    </div>
<nav aria-label="Page" id="bd-toc-nav">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#the-weather-dataset">
   The weather dataset
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#inspect-and-cleanup">
     Inspect and cleanup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#feature-engineering">
     Feature engineering
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#split-data">
     Split data
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#normalize-data">
     Normalize data
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#data-windowing">
   Data windowing
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#split">
     Split
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#create-tf-data-datasets">
     Create
     <code class="docutils literal notranslate">
<span class="pre">
       tf.data.Dataset
      </span>
</code>
     s
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#single-step-models">
   Single step models
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#baseline">
     Baseline
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#linear-model">
     Linear model
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#dense">
     Dense
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-step-dense">
     Multi-step dense
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#convolution-neural-network">
     Convolution neural network
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#recurrent-neural-networks">
     Recurrent neural networks
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#performance">
     Performance
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-output-models">
     Multi-output models
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
       Baseline
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
       Dense
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#rnn">
       RNN
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#advanced-residual-connections">
       Advanced: Residual Connections
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
       Performance
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-step-models">
   Multi-step models
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#baselines">
     Baselines
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#single-shot-models">
     Single-shot models
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#linear">
       Linear
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
       Dense
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#cnn">
       CNN
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id5">
       RNN
      </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#advanced-autoregressive-model">
     Advanced: Autoregressive model
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id6">
       RNN
      </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id7">
     Performance
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<div class="article row">
<div class="col pl-md-3 pl-lg-5 content-container">
<!-- Table of contents that is only displayed when printing the page -->
<div class="onlyprint" id="jb-print-docs-body">
<h1>Time series forecasting</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#the-weather-dataset">
   The weather dataset
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#inspect-and-cleanup">
     Inspect and cleanup
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#feature-engineering">
     Feature engineering
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#split-data">
     Split data
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#normalize-data">
     Normalize data
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#data-windowing">
   Data windowing
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#split">
     Split
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#create-tf-data-datasets">
     Create
     <code class="docutils literal notranslate">
<span class="pre">
       tf.data.Dataset
      </span>
</code>
     s
    </a>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#single-step-models">
   Single step models
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#baseline">
     Baseline
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#linear-model">
     Linear model
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#dense">
     Dense
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-step-dense">
     Multi-step dense
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#convolution-neural-network">
     Convolution neural network
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#recurrent-neural-networks">
     Recurrent neural networks
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#performance">
     Performance
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-output-models">
     Multi-output models
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id1">
       Baseline
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id2">
       Dense
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#rnn">
       RNN
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#advanced-residual-connections">
       Advanced: Residual Connections
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id3">
       Performance
      </a>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry">
<a class="reference internal nav-link" href="#multi-step-models">
   Multi-step models
  </a>
<ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#baselines">
     Baselines
    </a>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#single-shot-models">
     Single-shot models
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#linear">
       Linear
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id4">
       Dense
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#cnn">
       CNN
      </a>
</li>
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id5">
       RNN
      </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#advanced-autoregressive-model">
     Advanced: Autoregressive model
    </a>
<ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry">
<a class="reference internal nav-link" href="#id6">
       RNN
      </a>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry">
<a class="reference internal nav-link" href="#id7">
     Performance
    </a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<main id="main-content" role="main">
<div>
<section class="tex2jax_ignore mathjax_ignore" id="time-series-forecasting">
<h1>Time series forecasting<a class="headerlink" href="#time-series-forecasting" title="Permalink to this headline">#</a></h1>
<ul class="simple">
<li><p>tensorflow/docs/site/en/tutorials/structured_data/<a class="reference external" href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/structured_data/time_series.ipynb">time_series.ipynb</a></p></li>
<li><p>Commit <code class="docutils literal notranslate"><span class="pre">e51ebb4</span></code> on May 9, 2022, <a class="reference external" href="https://github.com/tensorflow/docs/compare/e51ebb4..">compare</a>.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">IPython</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">'axes.grid'</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<section id="the-weather-dataset">
<h2>The weather dataset<a class="headerlink" href="#the-weather-dataset" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>14 features (air temperature, atmospheric pressure, and humidity)</p></li>
<li><p>Collected every 10 minutes (use hourly predictions)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">zip_path</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="n">origin</span><span class="o">=</span><span class="s1">'https://storage.googleapis.com/tensorflow/tf-keras-datasets/jena_climate_2009_2016.csv.zip'</span><span class="p">,</span>
    <span class="n">extract</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">csv_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">zip_path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">csv_path</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>'/home/eavelar/.keras/datasets/jena_climate_2009_2016.csv'
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_path</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">5</span><span class="p">::</span><span class="mi">6</span><span class="p">]</span> 

<span class="n">date_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'Date Time'</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">'</span><span class="si">%d</span><span class="s1">.%m.%Y %H:%M:%S'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>p (mbar)</th>
<th>T (degC)</th>
<th>Tpot (K)</th>
<th>Tdew (degC)</th>
<th>rh (%)</th>
<th>VPmax (mbar)</th>
<th>VPact (mbar)</th>
<th>VPdef (mbar)</th>
<th>sh (g/kg)</th>
<th>H2OC (mmol/mol)</th>
<th>rho (g/m**3)</th>
<th>wv (m/s)</th>
<th>max. wv (m/s)</th>
<th>wd (deg)</th>
</tr>
</thead>
<tbody>
<tr>
<th>5</th>
<td>996.50</td>
<td>-8.05</td>
<td>265.38</td>
<td>-8.78</td>
<td>94.4</td>
<td>3.33</td>
<td>3.14</td>
<td>0.19</td>
<td>1.96</td>
<td>3.15</td>
<td>1307.86</td>
<td>0.21</td>
<td>0.63</td>
<td>192.7</td>
</tr>
<tr>
<th>11</th>
<td>996.62</td>
<td>-8.88</td>
<td>264.54</td>
<td>-9.77</td>
<td>93.2</td>
<td>3.12</td>
<td>2.90</td>
<td>0.21</td>
<td>1.81</td>
<td>2.91</td>
<td>1312.25</td>
<td>0.25</td>
<td>0.63</td>
<td>190.3</td>
</tr>
<tr>
<th>17</th>
<td>996.84</td>
<td>-8.81</td>
<td>264.59</td>
<td>-9.66</td>
<td>93.5</td>
<td>3.13</td>
<td>2.93</td>
<td>0.20</td>
<td>1.83</td>
<td>2.94</td>
<td>1312.18</td>
<td>0.18</td>
<td>0.63</td>
<td>167.2</td>
</tr>
<tr>
<th>23</th>
<td>996.99</td>
<td>-9.05</td>
<td>264.34</td>
<td>-10.02</td>
<td>92.6</td>
<td>3.07</td>
<td>2.85</td>
<td>0.23</td>
<td>1.78</td>
<td>2.85</td>
<td>1313.61</td>
<td>0.10</td>
<td>0.38</td>
<td>240.0</td>
</tr>
<tr>
<th>29</th>
<td>997.46</td>
<td>-9.63</td>
<td>263.72</td>
<td>-10.65</td>
<td>92.2</td>
<td>2.94</td>
<td>2.71</td>
<td>0.23</td>
<td>1.69</td>
<td>2.71</td>
<td>1317.19</td>
<td>0.40</td>
<td>0.88</td>
<td>157.0</td>
</tr>
</tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">,</span> <span class="s1">'p (mbar)'</span><span class="p">,</span> <span class="s1">'rho (g/m**3)'</span><span class="p">]</span>
<span class="n">plot_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">]</span>
<span class="n">plot_features</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date_time</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_features</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plot_features</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">plot_cols</span><span class="p">][:</span><span class="mi">480</span><span class="p">]</span>
<span class="n">plot_features</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">date_time</span><span class="p">[:</span><span class="mi">480</span><span class="p">]</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot_features</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subplots</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_7_0.png" src="../../_images/time_series_7_0.png"/>
<img alt="../../_images/time_series_7_1.png" src="../../_images/time_series_7_1.png"/>
</div>
</div>
<section id="inspect-and-cleanup">
<h3>Inspect and cleanup<a class="headerlink" href="#inspect-and-cleanup" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>count</th>
<th>mean</th>
<th>std</th>
<th>min</th>
<th>25%</th>
<th>50%</th>
<th>75%</th>
<th>max</th>
</tr>
</thead>
<tbody>
<tr>
<th>p (mbar)</th>
<td>70091.0</td>
<td>989.212842</td>
<td>8.358886</td>
<td>913.60</td>
<td>984.20</td>
<td>989.57</td>
<td>994.720</td>
<td>1015.29</td>
</tr>
<tr>
<th>T (degC)</th>
<td>70091.0</td>
<td>9.450482</td>
<td>8.423384</td>
<td>-22.76</td>
<td>3.35</td>
<td>9.41</td>
<td>15.480</td>
<td>37.28</td>
</tr>
<tr>
<th>Tpot (K)</th>
<td>70091.0</td>
<td>283.493086</td>
<td>8.504424</td>
<td>250.85</td>
<td>277.44</td>
<td>283.46</td>
<td>289.530</td>
<td>311.21</td>
</tr>
<tr>
<th>Tdew (degC)</th>
<td>70091.0</td>
<td>4.956471</td>
<td>6.730081</td>
<td>-24.80</td>
<td>0.24</td>
<td>5.21</td>
<td>10.080</td>
<td>23.06</td>
</tr>
<tr>
<th>rh (%)</th>
<td>70091.0</td>
<td>76.009788</td>
<td>16.474920</td>
<td>13.88</td>
<td>65.21</td>
<td>79.30</td>
<td>89.400</td>
<td>100.00</td>
</tr>
<tr>
<th>VPmax (mbar)</th>
<td>70091.0</td>
<td>13.576576</td>
<td>7.739883</td>
<td>0.97</td>
<td>7.77</td>
<td>11.82</td>
<td>17.610</td>
<td>63.77</td>
</tr>
<tr>
<th>VPact (mbar)</th>
<td>70091.0</td>
<td>9.533968</td>
<td>4.183658</td>
<td>0.81</td>
<td>6.22</td>
<td>8.86</td>
<td>12.360</td>
<td>28.25</td>
</tr>
<tr>
<th>VPdef (mbar)</th>
<td>70091.0</td>
<td>4.042536</td>
<td>4.898549</td>
<td>0.00</td>
<td>0.87</td>
<td>2.19</td>
<td>5.300</td>
<td>46.01</td>
</tr>
<tr>
<th>sh (g/kg)</th>
<td>70091.0</td>
<td>6.022560</td>
<td>2.655812</td>
<td>0.51</td>
<td>3.92</td>
<td>5.59</td>
<td>7.800</td>
<td>18.07</td>
</tr>
<tr>
<th>H2OC (mmol/mol)</th>
<td>70091.0</td>
<td>9.640437</td>
<td>4.234862</td>
<td>0.81</td>
<td>6.29</td>
<td>8.96</td>
<td>12.490</td>
<td>28.74</td>
</tr>
<tr>
<th>rho (g/m**3)</th>
<td>70091.0</td>
<td>1216.061232</td>
<td>39.974263</td>
<td>1059.45</td>
<td>1187.47</td>
<td>1213.80</td>
<td>1242.765</td>
<td>1393.54</td>
</tr>
<tr>
<th>wv (m/s)</th>
<td>70091.0</td>
<td>1.702567</td>
<td>65.447512</td>
<td>-9999.00</td>
<td>0.99</td>
<td>1.76</td>
<td>2.860</td>
<td>14.01</td>
</tr>
<tr>
<th>max. wv (m/s)</th>
<td>70091.0</td>
<td>2.963041</td>
<td>75.597657</td>
<td>-9999.00</td>
<td>1.76</td>
<td>2.98</td>
<td>4.740</td>
<td>23.50</td>
</tr>
<tr>
<th>wd (deg)</th>
<td>70091.0</td>
<td>174.789095</td>
<td>86.619431</td>
<td>0.00</td>
<td>125.30</td>
<td>198.10</td>
<td>234.000</td>
<td>360.00</td>
</tr>
</tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">-9999</span></code> is likely erroneous, replace it with zeros.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'wv (m/s)'</span><span class="p">]</span>
<span class="n">wv</span><span class="p">[</span><span class="n">wv</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">max_wv</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'max. wv (m/s)'</span><span class="p">]</span>
<span class="n">max_wv</span><span class="p">[</span><span class="n">max_wv</span> <span class="o">==</span> <span class="o">-</span><span class="mf">9999.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">df</span><span class="p">[</span><span class="s1">'wv (m/s)'</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="feature-engineering">
<h3>Feature engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'wd (deg)'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">'wv (m/s)'</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Wind Direction [deg]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Wind Velocity [m/s]'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, 'Wind Velocity [m/s]')
</pre></div>
</div>
<img alt="../../_images/time_series_13_1.png" src="../../_images/time_series_13_1.png"/>
</div>
</div>
<p>Convert the wind direction and velocity columns to a wind <strong>vector</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'wv (m/s)'</span><span class="p">)</span>
<span class="n">max_wv</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'max. wv (m/s)'</span><span class="p">)</span>

<span class="c1"># Convert to radians.</span>
<span class="n">wd_rad</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">'wd (deg)'</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">180</span>

<span class="c1"># Calculate the wind x and y components.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Wx'</span><span class="p">]</span> <span class="o">=</span> <span class="n">wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Wy'</span><span class="p">]</span> <span class="o">=</span> <span class="n">wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>

<span class="c1"># Calculate the max wind x and y components.</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'max Wx'</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'max Wy'</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_wv</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">wd_rad</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">hist2d</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Wx'</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Wy'</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Wind X [m/s]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Wind Y [m/s]'</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">'tight'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-11.305513973134667, 8.24469928549079, -8.27438540335515, 7.7338312955467785)
</pre></div>
</div>
<img alt="../../_images/time_series_16_1.png" src="../../_images/time_series_16_1.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timestamp_s</span> <span class="o">=</span> <span class="n">date_time</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">day</span> <span class="o">=</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span>
<span class="n">year</span> <span class="o">=</span> <span class="mf">365.2425</span> <span class="o">*</span> <span class="n">day</span>

<span class="n">df</span><span class="p">[</span><span class="s1">'Day sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">day</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Day cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">day</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Year sin'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">year</span><span class="p">))</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Year cos'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">timestamp_s</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">year</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Day sin'</span><span class="p">])[:</span><span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Day cos'</span><span class="p">])[:</span><span class="mi">25</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time [h]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Time of day signal'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_19_0.png" src="../../_images/time_series_19_0.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fft</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">rfft</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>
<span class="n">f_per_dataset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fft</span><span class="p">))</span>

<span class="n">n_samples_h</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>
<span class="n">hours_per_year</span> <span class="o">=</span> <span class="mi">24</span><span class="o">*</span><span class="mf">365.2524</span>
<span class="n">years_per_dataset</span> <span class="o">=</span> <span class="n">n_samples_h</span><span class="o">/</span><span class="p">(</span><span class="n">hours_per_year</span><span class="p">)</span>

<span class="n">f_per_year</span> <span class="o">=</span> <span class="n">f_per_dataset</span><span class="o">/</span><span class="n">years_per_dataset</span>
<span class="n">plt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">f_per_year</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fft</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">400000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">())])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">365.2524</span><span class="p">],</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s1">'1/Year'</span><span class="p">,</span> <span class="s1">'1/day'</span><span class="p">])</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Frequency (log scale)'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_20_0.png" src="../../_images/time_series_20_0.png"/>
</div>
</div>
</section>
<section id="split-data">
<h3>Split data<a class="headerlink" href="#split-data" title="Permalink to this headline">#</a></h3>
<p>training -&gt; <code class="docutils literal notranslate"><span class="pre">70%</span></code>, validation -&gt; <code class="docutils literal notranslate"><span class="pre">20%</span></code>, test -&gt; <code class="docutils literal notranslate"><span class="pre">10%</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">train_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">val_limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="mf">0.9</span><span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[:</span><span class="n">train_limit</span><span class="p">]</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">train_limit</span><span class="p">:</span><span class="n">val_limit</span><span class="p">]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">val_limit</span><span class="p">:]</span>

<span class="n">num_features</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="normalize-data">
<h3>Normalize data<a class="headerlink" href="#normalize-data" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>this normalization should be done using moving averages (in the interest of simplicity this tutorial uses a simple average)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_mean</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">train_std</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<span class="n">val_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">val_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_std</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">train_mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">train_std</span>
<span class="n">df_std</span> <span class="o">=</span> <span class="n">df_std</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">var_name</span><span class="o">=</span><span class="s1">'Column'</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">'Normalized'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">'Column'</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">'Normalized'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_std</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_27_0.png" src="../../_images/time_series_27_0.png"/>
</div>
</div>
</section>
</section>
<section id="data-windowing">
<h2>Data windowing<a class="headerlink" href="#data-windowing" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WindowGenerator</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_width</span><span class="p">,</span> <span class="n">label_width</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> 
                    <span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">val_df</span><span class="o">=</span><span class="n">val_df</span><span class="p">,</span> <span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span><span class="p">,</span> 
                    <span class="n">label_columns</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">val_df</span><span class="o">=</span><span class="n">val_df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_df</span><span class="o">=</span><span class="n">test_df</span>

        <span class="c1"># Work out the label columns indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="o">=</span> <span class="n">label_columns</span>
        <span class="k">if</span> <span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">label_columns</span><span class="p">)}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)}</span>

        <span class="c1"># Work out the window parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span> <span class="o">=</span> <span class="n">input_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span> <span class="o">=</span> <span class="n">label_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift</span> <span class="o">=</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">=</span> <span class="n">input_width</span> <span class="o">+</span> <span class="n">shift</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">input_width</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">label_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_start</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
        <span class="sa">f</span><span class="s1">'Total window size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">'Input indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">'Label indices: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="si">}</span><span class="s1">'</span><span class="p">,</span>
        <span class="sa">f</span><span class="s1">'Label column name(s): </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="si">}</span><span class="s1">'</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w1</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                     <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>
<span class="n">w1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 48
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
Label indices: [47]
Label column name(s): ['T (degC)']
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                     <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>
<span class="n">w2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 7
Input indices: [0 1 2 3 4 5]
Label indices: [6]
Label column name(s): ['T (degC)']
</pre></div>
</div>
</div>
</div>
<section id="split">
<h3>Split<a class="headerlink" href="#split" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">split_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
    <span class="n">inputs</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_slice</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">features</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels_slice</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">labels</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Slicing doesn't preserve static shape information, so set the shapes</span>
    <span class="c1"># manually. This way the `tf.data.Datasets` are easier to inspect.</span>
    <span class="n">inputs</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">set_shape</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_width</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">split_window</span> <span class="o">=</span> <span class="n">split_window</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stack three slices, the length of the total window.</span>
<span class="n">example_window</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[:</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">100</span><span class="o">+</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">200</span><span class="o">+</span><span class="n">w2</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">])])</span>

<span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="o">=</span> <span class="n">w2</span><span class="o">.</span><span class="n">split_window</span><span class="p">(</span><span class="n">example_window</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'All shapes are: (batch, time, features)'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Window shape: </span><span class="si">{</span><span class="n">example_window</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Inputs shape: </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Labels shape: </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>All shapes are: (batch, time, features)
Window shape: (3, 7, 19)
Inputs shape: (3, 6, 19)
Labels shape: (3, 1, 1)
</pre></div>
</div>
</div>
</div>
<p>The innermost indices are the features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span><span class="o">.</span><span class="n">example</span> <span class="o">=</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_col</span><span class="o">=</span><span class="s1">'T (degC)'</span><span class="p">,</span> <span class="n">max_subplots</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
  <span class="n">inputs</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">example</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
  <span class="n">plot_col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_indices</span><span class="p">[</span><span class="n">plot_col</span><span class="p">]</span>
  <span class="n">max_n</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_subplots</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>
  <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_n</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">max_n</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">plot_col</span><span class="si">}</span><span class="s1"> [normed]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_indices</span><span class="p">,</span> <span class="n">inputs</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">plot_col_index</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">'Inputs'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">10</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns</span><span class="p">:</span>
      <span class="n">label_col_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_columns_indices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">plot_col</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">label_col_index</span> <span class="o">=</span> <span class="n">plot_col_index</span>

    <span class="k">if</span> <span class="n">label_col_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="k">continue</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="p">,</span> <span class="n">labels</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">label_col_index</span><span class="p">],</span>
                <span class="n">edgecolors</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Labels'</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">'#2ca02c'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">label_indices</span><span class="p">,</span> <span class="n">predictions</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="p">:,</span> <span class="n">label_col_index</span><span class="p">],</span>
                  <span class="n">marker</span><span class="o">=</span><span class="s1">'X'</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Predictions'</span><span class="p">,</span>
                  <span class="n">c</span><span class="o">=</span><span class="s1">'#ff7f0e'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

  <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time [h]'</span><span class="p">)</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_38_0.png" src="../../_images/time_series_38_0.png"/>
</div>
</div>
</section>
<section id="create-tf-data-datasets">
<h3>Create <code class="docutils literal notranslate"><span class="pre">tf.data.Dataset</span></code>s<a class="headerlink" href="#create-tf-data-datasets" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">timeseries_dataset_from_array</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">targets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sequence_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">total_window_size</span><span class="p">,</span>
        <span class="n">sequence_stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">split_window</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ds</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">make_dataset</span> <span class="o">=</span> <span class="n">make_dataset</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="p">)</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">val</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">val_df</span><span class="p">)</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_dataset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">test_df</span><span class="p">)</span>

<span class="nd">@property</span>
<span class="k">def</span> <span class="nf">example</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Get and cache an example batch of `inputs, labels` for plotting."""</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">'_example'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># No example batch was found, so get one from the `.train` dataset</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train</span><span class="p">))</span>
        <span class="c1"># And cache it for next time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_example</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">train</span> <span class="o">=</span> <span class="n">train</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">test</span> <span class="o">=</span> <span class="n">test</span>
<span class="n">WindowGenerator</span><span class="o">.</span><span class="n">example</span> <span class="o">=</span> <span class="n">example</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w2</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">element_spec</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(TensorSpec(shape=(None, 6, 19), dtype=tf.float32, name=None),
 TensorSpec(shape=(None, 1, 1), dtype=tf.float32, name=None))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">w2</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inputs shape (batch, time, features): (32, 6, 19)
Labels shape (batch, time, features): (32, 1, 1)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="single-step-models">
<h2>Single step models<a class="headerlink" href="#single-step-models" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_step_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>
<span class="n">single_step_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 2
Input indices: [0]
Label indices: [1]
Label column name(s): ['T (degC)']
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">single_step_window</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inputs shape (batch, time, features): (32, 1, 19)
Labels shape (batch, time, features): (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<section id="baseline">
<h3>Baseline<a class="headerlink" href="#baseline" title="Permalink to this headline">#</a></h3>
<p>Start with a model that just returns the current temperature as the prediction, predicting “No change”. This is a reasonable baseline since temperature changes slowly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Baseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="o">=</span> <span class="n">label_index</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inputs</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">label_index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">tf</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">(</span><span class="n">label_index</span><span class="o">=</span><span class="n">column_indices</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>

<span class="n">baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                 <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="n">val_performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Baseline'</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Baseline'</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>439/439 [==============================] - 2s 4ms/step - loss: 0.0128 - mean_absolute_error: 0.0785
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>

<span class="n">wide_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 25
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
Label indices: [ 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24]
Label column name(s): ['T (degC)']
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">baseline</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 24, 19)
Output shape: (32, 24, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_53_0.png" src="../../_images/time_series_53_0.png"/>
</div>
</div>
</section>
<section id="linear-model">
<h3>Linear model<a class="headerlink" href="#linear-model" title="Permalink to this headline">#</a></h3>
<p>A <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Dense</span></code> layer with no <code class="docutils literal notranslate"><span class="pre">activation</span></code> set is a linear model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">linear</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">single_step_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">linear</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 1, 19)
Output shape: (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MAX_EPOCHS</span> <span class="o">=</span> <span class="mi">20</span>

<span class="k">def</span> <span class="nf">compile_and_fit</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">early_stopping</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="n">patience</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                  <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
                  <span class="n">metrics</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">())</span>
    
    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">MAX_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
                        <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">history</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span> <span class="n">single_step_window</span><span class="p">)</span>

<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Linear'</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Linear'</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
1534/1534 [==============================] - 14s 8ms/step - loss: 0.0548 - mean_absolute_error: 0.1522 - val_loss: 0.0117 - val_mean_absolute_error: 0.0789
Epoch 2/20
1534/1534 [==============================] - 12s 8ms/step - loss: 0.0102 - mean_absolute_error: 0.0743 - val_loss: 0.0091 - val_mean_absolute_error: 0.0698
Epoch 3/20
1534/1534 [==============================] - 12s 8ms/step - loss: 0.0094 - mean_absolute_error: 0.0711 - val_loss: 0.0088 - val_mean_absolute_error: 0.0692
Epoch 4/20
1534/1534 [==============================] - 12s 8ms/step - loss: 0.0092 - mean_absolute_error: 0.0703 - val_loss: 0.0088 - val_mean_absolute_error: 0.0686
Epoch 5/20
1534/1534 [==============================] - 11s 7ms/step - loss: 0.0091 - mean_absolute_error: 0.0698 - val_loss: 0.0086 - val_mean_absolute_error: 0.0680
Epoch 6/20
1534/1534 [==============================] - 12s 8ms/step - loss: 0.0091 - mean_absolute_error: 0.0698 - val_loss: 0.0089 - val_mean_absolute_error: 0.0693
Epoch 7/20
1534/1534 [==============================] - 12s 8ms/step - loss: 0.0091 - mean_absolute_error: 0.0697 - val_loss: 0.0086 - val_mean_absolute_error: 0.0681
439/439 [==============================] - 3s 6ms/step - loss: 0.0086 - mean_absolute_error: 0.0681
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">linear</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_60_0.png" src="../../_images/time_series_60_0.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)),</span> <span class="n">height</span><span class="o">=</span><span class="n">linear</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">kernel</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<span class="n">axis</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">axis</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">axis</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_61_0.png" src="../../_images/time_series_61_0.png"/>
</div>
</div>
<p>Sometimes the model doesn’t even place the most weight on the output <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">(degC)</span></code>. This is one of the risks of random initialization.</p>
</section>
<section id="dense">
<h3>Dense<a class="headerlink" href="#dense" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">dense</span><span class="p">,</span> <span class="n">single_step_window</span><span class="p">)</span>

<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
1534/1534 [==============================] - 21s 12ms/step - loss: 0.0144 - mean_absolute_error: 0.0778 - val_loss: 0.0075 - val_mean_absolute_error: 0.0622
Epoch 2/20
1534/1534 [==============================] - 19s 12ms/step - loss: 0.0077 - mean_absolute_error: 0.0635 - val_loss: 0.0069 - val_mean_absolute_error: 0.0584
Epoch 3/20
1534/1534 [==============================] - 20s 13ms/step - loss: 0.0074 - mean_absolute_error: 0.0619 - val_loss: 0.0068 - val_mean_absolute_error: 0.0571
Epoch 4/20
1534/1534 [==============================] - 18s 12ms/step - loss: 0.0071 - mean_absolute_error: 0.0603 - val_loss: 0.0069 - val_mean_absolute_error: 0.0578
Epoch 5/20
1534/1534 [==============================] - 19s 13ms/step - loss: 0.0070 - mean_absolute_error: 0.0599 - val_loss: 0.0070 - val_mean_absolute_error: 0.0590
439/439 [==============================] - 4s 8ms/step - loss: 0.0070 - mean_absolute_error: 0.0590
</pre></div>
</div>
</div>
</div>
</section>
<section id="multi-step-dense">
<h3>Multi-step dense<a class="headerlink" href="#multi-step-dense" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CONV_WIDTH</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">conv_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>

<span class="n">conv_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 4
Input indices: [0 1 2]
Label indices: [3]
Label column name(s): ['T (degC)']
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv_window</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Given 3 hours of inputs, predict 1 hour into the future"</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, 'Given 3 hours of inputs, predict 1 hour into the future')
</pre></div>
</div>
<img alt="../../_images/time_series_67_1.png" src="../../_images/time_series_67_1.png"/>
</div>
</div>
<p>You could train a <code class="docutils literal notranslate"><span class="pre">dense</span></code> model on a multiple-input-step window by adding a <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Flatten</span></code> as the first layer of the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_step_dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># (batch, time, features) =&gt; (batch, time*features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Flatten</span><span class="p">(),</span>
    <span class="c1"># (batch, time*features) =&gt;</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
    <span class="c1"># Add back the time dimension</span>
    <span class="c1"># (batch, 1) =&gt; </span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># (batch, 1, 1)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">multi_step_dense</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 3, 19)
Output shape: (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_step_dense</span><span class="p">,</span> <span class="n">conv_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Multi step dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_step_dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Multi step dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_step_dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 2s 5ms/step - loss: 0.0066 - mean_absolute_error: 0.0565
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_step_dense</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_72_0.png" src="../../_images/time_series_72_0.png"/>
</div>
</div>
</section>
<section id="convolution-neural-network">
<h3>Convolution neural network<a class="headerlink" href="#convolution-neural-network" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conv_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">CONV_WIDTH</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">conv_model</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 3, 19)
Output shape: (32, 1, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">conv_model</span><span class="p">,</span> <span class="n">conv_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Conv'</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Conv'</span><span class="p">]</span> <span class="o">=</span> <span class="n">conv_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">conv_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 4s 8ms/step - loss: 0.0062 - mean_absolute_error: 0.0559
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Wide window'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Labels shape:'</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">conv_model</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wide window
Input shape: (32, 24, 19)
Labels shape: (32, 24, 1)
Output shape: (32, 22, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LABEL_WIDTH</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">INPUT_WIDTH</span> <span class="o">=</span> <span class="n">LABEL_WIDTH</span> <span class="o">+</span> <span class="p">(</span><span class="n">CONV_WIDTH</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">wide_conv_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span>
    <span class="n">input_width</span><span class="o">=</span><span class="n">INPUT_WIDTH</span><span class="p">,</span>
    <span class="n">label_width</span><span class="o">=</span><span class="n">LABEL_WIDTH</span><span class="p">,</span>
    <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">label_columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'T (degC)'</span><span class="p">])</span>

<span class="n">wide_conv_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 27
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
 24 25]
Label indices: [ 3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26]
Label column name(s): ['T (degC)']
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Wide conv window'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">wide_conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Labels window:'</span><span class="p">,</span> <span class="n">wide_conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">conv_model</span><span class="p">(</span><span class="n">wide_conv_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Wide conv window
Input shape: (32, 26, 19)
Labels window: (32, 24, 1)
Output shape: (32, 24, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wide_conv_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">conv_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_80_0.png" src="../../_images/time_series_80_0.png"/>
</div>
</div>
</section>
<section id="recurrent-neural-networks">
<h3>Recurrent neural networks<a class="headerlink" href="#recurrent-neural-networks" title="Permalink to this headline">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">return_sequences</span></code> argument:</p>
<ul class="simple">
<li><p>Stacking RNN layers</p></li>
<li><p>Training a model on multiple time steps simultaneously</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># (batch, time, features) =&gt;</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span> 
    <span class="c1"># (batch, time, 32) =&gt;</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
    <span class="c1"># (batch, time, 1)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Input shape:'</span><span class="p">,</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape:'</span><span class="p">,</span> <span class="n">lstm_model</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Input shape: (32, 24, 19)
Output shape: (32, 24, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">lstm_model</span><span class="p">,</span> <span class="n">wide_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 4s 8ms/step - loss: 0.0056 - mean_absolute_error: 0.0516
</pre></div>
</div>
</div>
</div>
</section>
<section id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">performance</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">metric_name</span> <span class="o">=</span> <span class="s1">'mean_absolute_error'</span>
<span class="n">metric_index</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">metrics_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">'mean_absolute_error'</span><span class="p">)</span>
<span class="n">val_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">test_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'mean_absolute_error [T (degC), normalized]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">val_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Validation'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">test_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Test'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">performance</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
           <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_87_0.png" src="../../_images/time_series_87_0.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s1">12s</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Baseline    : 0.0852
Linear      : 0.0669
Dense       : 0.0596
Multi step dense: 0.0566
Conv        : 0.0579
LSTM        : 0.0519
</pre></div>
</div>
</div>
</div>
</section>
<section id="multi-output-models">
<h3>Multi-output models<a class="headerlink" href="#multi-output-models" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">single_step_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">wide_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">label_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">example_inputs</span><span class="p">,</span> <span class="n">example_labels</span> <span class="ow">in</span> <span class="n">wide_window</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Inputs shape (batch, time, features): </span><span class="si">{</span><span class="n">example_inputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Labels shape (batch, time, features): </span><span class="si">{</span><span class="n">example_labels</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inputs shape (batch, time, features): (32, 24, 19)
Labels shape (batch, time, features): (32, 24, 19)
</pre></div>
</div>
</div>
</div>
<section id="id1">
<h4>Baseline<a class="headerlink" href="#id1" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">baseline</span> <span class="o">=</span> <span class="n">Baseline</span><span class="p">()</span>
<span class="n">baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                 <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">val_performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Baseline'</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Baseline'</span><span class="p">]</span> <span class="o">=</span> <span class="n">baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 2s 5ms/step - loss: 0.0886 - mean_absolute_error: 0.1589
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h4>Dense<a class="headerlink" href="#id2" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_features</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">dense</span><span class="p">,</span> <span class="n">single_step_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dense</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">single_step_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>439/439 [==============================] - 4s 9ms/step - loss: 0.0683 - mean_absolute_error: 0.1309
</pre></div>
</div>
</div>
</div>
</section>
<section id="rnn">
<h4>RNN<a class="headerlink" href="#rnn" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">lstm_model</span><span class="p">,</span> <span class="n">wide_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 4s 9ms/step - loss: 0.0615 - mean_absolute_error: 0.1198
</pre></div>
</div>
</div>
</div>
</section>
<section id="advanced-residual-connections">
<h4>Advanced: Residual Connections<a class="headerlink" href="#advanced-residual-connections" title="Permalink to this headline">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">Baseline</span></code> model from earlier took advantage of the fact that the sequence doesn’t change drastically from time step to time step.</p>
<p>It’s common in time series analysis to build models that instead of predicting the next value, predict how the value will change in the next time step.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ResidualWrapper</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">inputs</span> <span class="o">+</span> <span class="n">delta</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">residual_lstm</span> <span class="o">=</span> <span class="n">ResidualWrapper</span><span class="p">(</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_features</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">())</span>
<span class="p">]))</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">residual_lstm</span><span class="p">,</span> <span class="n">wide_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">val_performance</span><span class="p">[</span><span class="s1">'Residual LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual_lstm</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">performance</span><span class="p">[</span><span class="s1">'Residual LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">residual_lstm</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">wide_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>438/438 [==============================] - 4s 8ms/step - loss: 0.0621 - mean_absolute_error: 0.1180
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h4>Performance<a class="headerlink" href="#id3" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">performance</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">metric_name</span> <span class="o">=</span> <span class="s1">'mean_absolute_error'</span>
<span class="n">metric_index</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">metrics_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">'mean_absolute_error'</span><span class="p">)</span>
<span class="n">val_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">test_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">val_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Validation'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">test_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Test'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">performance</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
           <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'MAE (average over all outputs)'</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/time_series_104_0.png" src="../../_images/time_series_104_0.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">performance</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">name</span><span class="si">:</span><span class="s1">15s</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">0.4f</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Baseline       : 0.1638
Dense          : 0.1324
LSTM           : 0.1219
Residual LSTM  : 0.1195
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="multi-step-models">
<h2>Multi-step models<a class="headerlink" href="#multi-step-models" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">OUT_STEPS</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">multi_window</span> <span class="o">=</span> <span class="n">WindowGenerator</span><span class="p">(</span><span class="n">input_width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                               <span class="n">label_width</span><span class="o">=</span><span class="n">OUT_STEPS</span><span class="p">,</span>
                               <span class="n">shift</span><span class="o">=</span><span class="n">OUT_STEPS</span><span class="p">)</span>

<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">multi_window</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total window size: 48
Input indices: [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23]
Label indices: [24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47]
Label column name(s): None
</pre></div>
</div>
<img alt="../../_images/time_series_107_1.png" src="../../_images/time_series_107_1.png"/>
</div>
</div>
<section id="baselines">
<h3>Baselines<a class="headerlink" href="#baselines" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MultiStepLastBaseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">inputs</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">OUT_STEPS</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    
<span class="n">last_baseline</span> <span class="o">=</span> <span class="n">MultiStepLastBaseline</span><span class="p">()</span>
<span class="n">last_baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                      <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="n">multi_val_performance</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">multi_performance</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'Last'</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'Last'</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">last_baseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 2s 5ms/step - loss: 0.6285 - mean_absolute_error: 0.5007
</pre></div>
</div>
<img alt="../../_images/time_series_109_1.png" src="../../_images/time_series_109_1.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RepeatBaseline</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">inputs</span>

<span class="n">repeat_baseline</span> <span class="o">=</span> <span class="n">RepeatBaseline</span><span class="p">()</span>
<span class="n">repeat_baseline</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
                        <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">()])</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'Repeat'</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeat_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'Repeat'</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeat_baseline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">repeat_baseline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 2s 5ms/step - loss: 0.4270 - mean_absolute_error: 0.3959
</pre></div>
</div>
<img alt="../../_images/time_series_110_1.png" src="../../_images/time_series_110_1.png"/>
</div>
</div>
</section>
<section id="single-shot-models">
<h3>Single-shot models<a class="headerlink" href="#single-shot-models" title="Permalink to this headline">#</a></h3>
<section id="linear">
<h4>Linear<a class="headerlink" href="#linear" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_linear_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># (batch, time, features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
    <span class="c1"># (batch, 1, features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
    <span class="c1"># (batch, out_steps, features)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_linear_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'Linear'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_linear_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'Linear'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_linear_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_linear_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 3s 6ms/step - loss: 0.2560 - mean_absolute_error: 0.3057
</pre></div>
</div>
<img alt="../../_images/time_series_113_1.png" src="../../_images/time_series_113_1.png"/>
</div>
</div>
</section>
<section id="id4">
<h4>Dense<a class="headerlink" href="#id4" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_dense_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># (batch, time, features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:,</span> <span class="p">:]),</span>
    <span class="c1"># (batch, 1, features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
    <span class="c1"># (batch, out_steps, features)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_dense_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'Dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_dense_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'Dense'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_dense_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_dense_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>437/437 [==============================] - 3s 7ms/step - loss: 0.2195 - mean_absolute_error: 0.2827
</pre></div>
</div>
<img alt="../../_images/time_series_115_1.png" src="../../_images/time_series_115_1.png"/>
</div>
</div>
</section>
<section id="cnn">
<h4>CNN<a class="headerlink" href="#cnn" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CONV_WIDTH</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">multi_conv_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># (batch, time, features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="n">CONV_WIDTH</span><span class="p">:,</span> <span class="p">:]),</span>
    <span class="c1"># (batch, CONV_WIDTH, features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv1D</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">CONV_WIDTH</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">'relu'</span><span class="p">),</span>
    <span class="c1"># (batch, 1, 256)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="c1"># (batch, 1,  out_steps*features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
    <span class="c1"># (batch, out_steps, features)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_conv_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'Conv'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_conv_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'Conv'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_conv_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_conv_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/20
1532/1532 [==============================] - 17s 10ms/step - loss: 0.2385 - mean_absolute_error: 0.3046 - val_loss: 0.2235 - val_mean_absolute_error: 0.2884
Epoch 2/20
1532/1532 [==============================] - 15s 10ms/step - loss: 0.2194 - mean_absolute_error: 0.2857 - val_loss: 0.2230 - val_mean_absolute_error: 0.2879
Epoch 3/20
1532/1532 [==============================] - 35s 23ms/step - loss: 0.2160 - mean_absolute_error: 0.2829 - val_loss: 0.2188 - val_mean_absolute_error: 0.2843
Epoch 4/20
1532/1532 [==============================] - 14s 9ms/step - loss: 0.2128 - mean_absolute_error: 0.2799 - val_loss: 0.2178 - val_mean_absolute_error: 0.2838
Epoch 5/20
1532/1532 [==============================] - 15s 10ms/step - loss: 0.2108 - mean_absolute_error: 0.2784 - val_loss: 0.2149 - val_mean_absolute_error: 0.2818
Epoch 6/20
1532/1532 [==============================] - 16s 10ms/step - loss: 0.2089 - mean_absolute_error: 0.2768 - val_loss: 0.2147 - val_mean_absolute_error: 0.2806
Epoch 7/20
1532/1532 [==============================] - 15s 10ms/step - loss: 0.2075 - mean_absolute_error: 0.2757 - val_loss: 0.2140 - val_mean_absolute_error: 0.2811
Epoch 8/20
1532/1532 [==============================] - 15s 10ms/step - loss: 0.2065 - mean_absolute_error: 0.2750 - val_loss: 0.2137 - val_mean_absolute_error: 0.2799
Epoch 9/20
1532/1532 [==============================] - 15s 10ms/step - loss: 0.2054 - mean_absolute_error: 0.2740 - val_loss: 0.2137 - val_mean_absolute_error: 0.2796
Epoch 10/20
1410/1532 [==========================&gt;...] - ETA: 6s - loss: 0.2044 - mean_absolute_error: 0.2733
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">line</span> <span class="mi">14</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">CONV_WIDTH</span> <span class="o">=</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">multi_conv_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>     <span class="c1"># (batch, time, features)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>     <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Lambda</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="n">CONV_WIDTH</span><span class="p">:,</span> <span class="p">:]),</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="c1"># (batch, out_steps, features)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="p">])</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_conv_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'Conv'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_conv_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>

<span class="nn">Cell In[39], line 10,</span> in <span class="ni">compile_and_fit</span><span class="nt">(model, window, patience)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">early_stopping</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span><span class="n">patience</span><span class="o">=</span><span class="n">patience</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'min'</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">losses</span><span class="o">.</span><span class="n">MeanSquaredError</span><span class="p">(),</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>               <span class="n">optimizer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">optimizers</span><span class="o">.</span><span class="n">Adam</span><span class="p">(),</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>               <span class="n">metrics</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">MeanAbsoluteError</span><span class="p">())</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">window</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">MAX_EPOCHS</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="n">window</span><span class="o">.</span><span class="n">val</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>                     <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="k">return</span> <span class="n">history</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/keras/utils/traceback_utils.py:65,</span> in <span class="ni">filter_traceback.&lt;locals&gt;.error_handler</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span> <span class="n">filtered_tb</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">65</span>     <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">filtered_tb</span> <span class="o">=</span> <span class="n">_process_traceback_frames</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/keras/engine/training.py:1685,</span> in <span class="ni">Model.fit</span><span class="nt">(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_batch_size, validation_freq, max_queue_size, workers, use_multiprocessing)</span>
<span class="g g-Whitespace">   </span><span class="mi">1677</span> <span class="k">with</span> <span class="n">tf</span><span class="o">.</span><span class="n">profiler</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">Trace</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1678</span>     <span class="s2">"train"</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1679</span>     <span class="n">epoch_num</span><span class="o">=</span><span class="n">epoch</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1682</span>     <span class="n">_r</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1683</span> <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1684</span>     <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1685</span>     <span class="n">tmp_logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_function</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1686</span>     <span class="k">if</span> <span class="n">data_handler</span><span class="o">.</span><span class="n">should_sync</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1687</span>         <span class="n">context</span><span class="o">.</span><span class="n">async_wait</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/util/traceback_utils.py:150,</span> in <span class="ni">filter_traceback.&lt;locals&gt;.error_handler</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="n">filtered_tb</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">150</span>   <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>   <span class="n">filtered_tb</span> <span class="o">=</span> <span class="n">_process_traceback_frames</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py:894,</span> in <span class="ni">Function.__call__</span><span class="nt">(self, *args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">891</span> <span class="n">compiler</span> <span class="o">=</span> <span class="s2">"xla"</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jit_compile</span> <span class="k">else</span> <span class="s2">"nonXla"</span>
<span class="g g-Whitespace">    </span><span class="mi">893</span> <span class="k">with</span> <span class="n">OptionalXlaContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jit_compile</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">894</span>   <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">896</span> <span class="n">new_tracing_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimental_get_tracing_count</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">897</span> <span class="n">without_tracing</span> <span class="o">=</span> <span class="p">(</span><span class="n">tracing_count</span> <span class="o">==</span> <span class="n">new_tracing_count</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/eager/polymorphic_function/polymorphic_function.py:926,</span> in <span class="ni">Function._call</span><span class="nt">(self, *args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">923</span>   <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">924</span>   <span class="c1"># In this case we have created variables on the first call, so we run the</span>
<span class="g g-Whitespace">    </span><span class="mi">925</span>   <span class="c1"># defunned version which is guaranteed to never create variables.</span>
<span class="ne">--&gt; </span><span class="mi">926</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_no_variable_creation_fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>  <span class="c1"># pylint: disable=not-callable</span>
<span class="g g-Whitespace">    </span><span class="mi">927</span> <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_creation_fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">928</span>   <span class="c1"># Release the lock early so that multiple threads can perform the call</span>
<span class="g g-Whitespace">    </span><span class="mi">929</span>   <span class="c1"># in parallel.</span>
<span class="g g-Whitespace">    </span><span class="mi">930</span>   <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/eager/polymorphic_function/tracing_compiler.py:143,</span> in <span class="ni">TracingCompiler.__call__</span><span class="nt">(self, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span>   <span class="p">(</span><span class="n">concrete_function</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">142</span>    <span class="n">filtered_flat_args</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maybe_define_function</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">143</span> <span class="k">return</span> <span class="n">concrete_function</span><span class="o">.</span><span class="n">_call_flat</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span>     <span class="n">filtered_flat_args</span><span class="p">,</span> <span class="n">captured_inputs</span><span class="o">=</span><span class="n">concrete_function</span><span class="o">.</span><span class="n">captured_inputs</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py:1757,</span> in <span class="ni">ConcreteFunction._call_flat</span><span class="nt">(self, args, captured_inputs, cancellation_manager)</span>
<span class="g g-Whitespace">   </span><span class="mi">1753</span> <span class="n">possible_gradient_type</span> <span class="o">=</span> <span class="n">gradients_util</span><span class="o">.</span><span class="n">PossibleTapeGradientTypes</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1754</span> <span class="k">if</span> <span class="p">(</span><span class="n">possible_gradient_type</span> <span class="o">==</span> <span class="n">gradients_util</span><span class="o">.</span><span class="n">POSSIBLE_GRADIENT_TYPES_NONE</span>
<span class="g g-Whitespace">   </span><span class="mi">1755</span>     <span class="ow">and</span> <span class="n">executing_eagerly</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1756</span>   <span class="c1"># No tape is watching; skip to running the function.</span>
<span class="ne">-&gt; </span><span class="mi">1757</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_call_outputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_inference_function</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1758</span>       <span class="n">ctx</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">cancellation_manager</span><span class="o">=</span><span class="n">cancellation_manager</span><span class="p">))</span>
<span class="g g-Whitespace">   </span><span class="mi">1759</span> <span class="n">forward_backward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_forward_and_backward_functions</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1760</span>     <span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1761</span>     <span class="n">possible_gradient_type</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1762</span>     <span class="n">executing_eagerly</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1763</span> <span class="n">forward_function</span><span class="p">,</span> <span class="n">args_with_tangents</span> <span class="o">=</span> <span class="n">forward_backward</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py:381,</span> in <span class="ni">_EagerDefinedFunction.call</span><span class="nt">(self, ctx, args, cancellation_manager)</span>
<span class="g g-Whitespace">    </span><span class="mi">379</span> <span class="k">with</span> <span class="n">_InterpolateFunctionError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">380</span>   <span class="k">if</span> <span class="n">cancellation_manager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">381</span>     <span class="n">outputs</span> <span class="o">=</span> <span class="n">execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">382</span>         <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">383</span>         <span class="n">num_outputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_outputs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">384</span>         <span class="n">inputs</span><span class="o">=</span><span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">385</span>         <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">386</span>         <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">387</span>   <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span>     <span class="n">outputs</span> <span class="o">=</span> <span class="n">execute</span><span class="o">.</span><span class="n">execute_with_cancellation</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>         <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">signature</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">390</span>         <span class="n">num_outputs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_outputs</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>         <span class="n">ctx</span><span class="o">=</span><span class="n">ctx</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">394</span>         <span class="n">cancellation_manager</span><span class="o">=</span><span class="n">cancellation_manager</span><span class="p">)</span>

<span class="nn">File ~/miniconda3/envs/mldev/lib/python3.9/site-packages/tensorflow/python/eager/execute.py:52,</span> in <span class="ni">quick_execute</span><span class="nt">(op_name, num_outputs, inputs, attrs, ctx, name)</span>
<span class="g g-Whitespace">     </span><span class="mi">50</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>   <span class="n">ctx</span><span class="o">.</span><span class="n">ensure_initialized</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">52</span>   <span class="n">tensors</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_Execute</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">op_name</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span>                                       <span class="n">inputs</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span> <span class="k">except</span> <span class="n">core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span>   <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h4>RNN<a class="headerlink" href="#id5" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">multi_lstm_model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">([</span>
    <span class="c1"># (batch, time, features)</span>
    <span class="c1"># Adding more `lstm_units` just overfits more quickly.</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
    <span class="c1"># (batch, lstm_units)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">OUT_STEPS</span><span class="o">*</span><span class="n">num_features</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">initializers</span><span class="o">.</span><span class="n">zeros</span><span class="p">()),</span>
    <span class="c1"># (batch, out_steps*features)</span>
    <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Reshape</span><span class="p">([</span><span class="n">OUT_STEPS</span><span class="p">,</span> <span class="n">num_features</span><span class="p">])</span>
    <span class="c1"># (batch, out_steps, features)</span>
<span class="p">])</span>

<span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">multi_lstm_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">multi_lstm_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">multi_lstm_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-autoregressive-model">
<h3>Advanced: Autoregressive model<a class="headerlink" href="#advanced-autoregressive-model" title="Permalink to this headline">#</a></h3>
<section id="id6">
<h4>RNN<a class="headerlink" href="#id6" title="Permalink to this headline">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FeedBack</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">out_steps</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_steps</span> <span class="o">=</span> <span class="n">out_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units</span> <span class="o">=</span> <span class="n">units</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm_cell</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">LSTMCell</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
        <span class="c1"># Also wrap the LSTMCell in an RNN to simplify the `warmup` method.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lstm_rnn</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lstm_cell</span><span class="p">,</span> <span class="n">return_state</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dense</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">num_features</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feedback_model</span> <span class="o">=</span> <span class="n">FeedBack</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">out_steps</span><span class="o">=</span><span class="n">OUT_STEPS</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">warmup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="c1"># inputs.shape =&gt; (batch, time, features)</span>
    <span class="c1"># x.shape =&gt; (batch, lstm_units)</span>
    <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm_rnn</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="c1"># predictions.shape =&gt; (batch, features)</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction</span><span class="p">,</span> <span class="n">state</span>

<span class="n">FeedBack</span><span class="o">.</span><span class="n">warmup</span> <span class="o">=</span> <span class="n">warmup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prediction</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="n">feedback_model</span><span class="o">.</span><span class="n">warmup</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">prediction</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Use a TensorArray to capture dynamically unrolled outputs.</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Initialize the LSTM state.</span>
    <span class="n">prediction</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">warmup</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

    <span class="c1"># Insert the first prediction.</span>
    <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>

    <span class="c1"># Run the rest of the prediction steps.</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_steps</span><span class="p">):</span>
        <span class="c1"># Use the last prediction as input.</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">prediction</span>
        <span class="c1"># Execute one lstm step.</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm_cell</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">states</span><span class="o">=</span><span class="n">state</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
        <span class="c1"># Convert the lstm output to a prediction.</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># Add the prediction to the output.</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>

    <span class="c1"># predictions.shape =&gt; (time, batch, features)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>
    <span class="c1"># predictions.shape =&gt; (batch, time, features)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">predictions</span>

<span class="n">FeedBack</span><span class="o">.</span><span class="n">call</span> <span class="o">=</span> <span class="n">call</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">'Output shape (batch, time, features): '</span><span class="p">,</span> <span class="n">feedback_model</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">example</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">compile_and_fit</span><span class="p">(</span><span class="n">feedback_model</span><span class="p">,</span> <span class="n">multi_window</span><span class="p">)</span>

<span class="n">IPython</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">clear_output</span><span class="p">()</span>

<span class="n">multi_val_performance</span><span class="p">[</span><span class="s1">'AR LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="n">multi_performance</span><span class="p">[</span><span class="s1">'AR LSTM'</span><span class="p">]</span> <span class="o">=</span> <span class="n">feedback_model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">multi_window</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">multi_window</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">feedback_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="id7">
<h3>Performance<a class="headerlink" href="#id7" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">multi_performance</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.3</span>

<span class="n">metric_name</span> <span class="o">=</span> <span class="s1">'mean_absolute_error'</span>
<span class="n">metric_index</span> <span class="o">=</span> <span class="n">lstm_model</span><span class="o">.</span><span class="n">metrics_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">'mean_absolute_error'</span><span class="p">)</span>
<span class="n">val_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_val_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">test_mae</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">metric_index</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">multi_performance</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">val_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Validation'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.17</span><span class="p">,</span> <span class="n">test_mae</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Test'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">multi_performance</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
           <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">'MAE (average over all times and outputs)'</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
</div>
</main>
<footer class="footer-article noprint">
<!-- Previous / next buttons -->
<div class="prev-next-area">
<a class="left-prev" href="index.html" id="prev-link" title="previous page">
<i class="fas fa-angle-left"></i>
<div class="prev-next-info">

<p class="prev-next-title">Structured Data</p>
</div>
</a>
<a class="right-next" href="../distribute/index.html" id="next-link" title="next page">
<div class="prev-next-info">

<p class="prev-next-title">Distributed training</p>
</div>
<i class="fas fa-angle-right"></i>
</a>
</div>
</footer>
</div>
</div>

</div>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
</body>
</html>